<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Dekko" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Pomodoro</title>
</head>
<body>
    <div class="bgImage"></div>
    <audio id="sound">
        <source src="Melody 1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    
    <h1>Pomodoro</h1>
    <span id="whichTime" style="font-size: 30px"></span>
    <div class="flex-container">

        <div class="timer">
            
            <p id="countdown">25:00</p>
        </div>
    
        <div class="settings">
            <button id="playPause" type="button" style="cursor:pointer">Start</button>
            <br>
            <button id="restart" type="button" style="cursor:pointer">Restart</button>
        </div>

        <div class="bear">
            <img id="image" src="bear.png">
        </div>

        <div class="playlist">
            <iframe width="560" height="315" src="https://www.youtube.com/embed/VMAPTo7RVCo?autoplay=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
        </div>
    </div>
    

    <footer>Pomodoro by Kate Rivera
        <br>
        <a href="https://github.com/katearevir"><i class="fa fa-github" style="font-size:30px;color:white"></i> GitHub</a>
    </footer>
</body>

<script>
var play = true;
var restart = false;

var restartButton = document.getElementById("restart");
var sound = document.getElementById("sound");
sound.volume = 0.05;
var iter = 0;

function startTimer(duration, display) {

    return new Promise(function(resolve, reject) {
        var timer = duration, minutes, seconds;
        
    var inter = setInterval(function () {
        if (play){
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;
            
            if (--timer < 0) {
                sound.play();
                clearInterval(inter);
                resolve("timer ended");
            }
            if (restart){
                display.textContent = "25:00";
                clearInterval(inter);
                resolve("timer ended");
            }
        }
        
    }, 1000);
                
    
    });
    
}

var playPauseButton = document.getElementById("playPause");

playPauseButton.onclick = function() {
    if (playPauseButton.innerText == "Start"){
        play = true;
        restart = false;
        playPauseButton.innerText = "Pause"
        display();
    }
    else if (playPauseButton.innerText == "Play"){
        play = true;
        playPauseButton.innerText = "Pause";
    }
    else if (playPauseButton.innerText == "Pause"){
        play = false;
        playPauseButton.innerText = "Play";
    }

}

restartButton.onclick = function(){
    playPauseButton.innerText = "Start";
    whichTimeText.innerText = "";
    restart = true;
    play = true;
    iter = 0;
}

var whichTimeText = document.getElementById("whichTime");
async function display() {
    var display = document.querySelector('#countdown');
    console.log("Hi");

    while(!restart){
        if (!restart && (iter % 4) !== 0 || iter === 0){
            var workTime = 60 * 25; //25 mins
            whichTimeText.innerText = "Work Time!"
            await startTimer(workTime, display);
            if (!restart){
                var shortBreak = 60*5; // 5 mins
                whichTimeText.innerText = "Short Break Time!"
                await startTimer(shortBreak, display);
            }
            iter++;
        }
        else if(!restart && (iter % 4) === 0){
            var longBreak = 60*15; // 15 mins
            whichTimeText.innerText = "Long Break Time!"
            await startTimer(longBreak, display);
            iter++;
        }
    }

}

</script>
</html>
